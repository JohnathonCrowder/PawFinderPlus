{% extends "base.html" %}

{% block title %}{{ dog.name }} - DogBreederPlus{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-4xl font-bold mb-6" style="color: #0080ff;">{{ dog.name }}</h1>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="bg-{{ 'green' if category == 'success' else 'red' }}-100 border border-{{ 'green' if category == 'success' else 'red' }}-400 text-{{ 'green' if category == 'success' else 'red' }}-700 px-4 py-3 rounded relative mb-4" role="alert">
                    <span class="block sm:inline">{{ message }}</span>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Image Gallery -->
    <div class="mb-8">
        <h2 class="text-2xl font-semibold mb-4">Photos</h2>
        {% if dog.images %}
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                {% for image in dog.images %}
                    <div class="relative group">
                        <img src="{{ url_for('uploaded_file', filename=image.filename) }}" 
                             alt="{{ dog.name }}" 
                             class="w-full h-48 object-cover rounded-lg shadow-md">
                        <form action="{{ url_for('delete_image', id=dog.id, image_id=image.id) }}" 
                              method="POST" 
                              class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button type="submit" 
                                    class="bg-red-500 hover:bg-red-700 text-white rounded-full p-2"
                                    onclick="return confirm('Are you sure you want to delete this image?')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-gray-500 italic">No images uploaded yet.</p>
        {% endif %}
    </div>

    <!-- Dog Details Form -->
    <form action="{{ url_for('dog_detail', id=dog.id) }}" method="POST" enctype="multipart/form-data" class="max-w-md">
        <div class="mb-4">
            <label for="name" class="block mb-2 font-semibold">Name</label>
            <input type="text" id="name" name="name" value="{{ dog.name }}" class="w-full px-3 py-2 border rounded-lg" required>
        </div>
        <div class="mb-4">
            <label for="breed" class="block mb-2 font-semibold">Breed</label>
            <input type="text" id="breed" name="breed" value="{{ dog.breed }}" class="w-full px-3 py-2 border rounded-lg" required>
        </div>
        <div class="mb-4">
            <label for="date_of_birth" class="block mb-2 font-semibold">Date of Birth</label>
            <input type="date" id="date_of_birth" name="date_of_birth" value="{{ dog.date_of_birth.strftime('%Y-%m-%d') }}" class="w-full px-3 py-2 border rounded-lg" required>
        </div>
        <div class="mb-4">
            <label for="gender" class="block mb-2 font-semibold">Gender</label>
            <select id="gender" name="gender" class="w-full px-3 py-2 border rounded-lg" required>
                <option value="Male" {% if dog.gender == 'Male' %}selected{% endif %}>Male</option>
                <option value="Female" {% if dog.gender == 'Female' %}selected{% endif %}>Female</option>
            </select>
        </div>
        <div class="mb-4">
            <label for="weight" class="block mb-2 font-semibold">Weight (kg)</label>
            <input type="number" id="weight" name="weight" value="{{ dog.weight or '' }}" step="0.1" class="w-full px-3 py-2 border rounded-lg">
        </div>
        <div class="mb-4">
            <label for="color" class="block mb-2 font-semibold">Color</label>
            <input type="text" id="color" name="color" value="{{ dog.color or '' }}" class="w-full px-3 py-2 border rounded-lg">
        </div>
        <div class="mb-4">
            <label for="images" class="block mb-2 font-semibold">Add New Images</label>
            <input type="file" id="images" name="images" multiple accept="image/*" class="w-full px-3 py-2 border rounded-lg">
        </div>
        <div class="flex space-x-4">
            <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Update Dog
            </button>
            <a href="{{ url_for('home') }}" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                Back to List
            </a>
        </div>
    </form>
    
    <!-- Delete Dog Form -->
    <form action="{{ url_for('delete_dog', id=dog.id) }}" method="POST" class="mt-8">
        <button type="submit" 
                class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" 
                onclick="return confirm('Are you sure you want to delete this dog? This action cannot be undone.')">
            Delete Dog
        </button>
    </form>
</div>

<!-- Modal for image preview (optional) -->
<div id="imageModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center">
    <div class="max-w-3xl max-h-full p-4">
        <img id="modalImage" src="" alt="Full size image" class="max-w-full max-h-full">
        <button onclick="closeModal()" class="absolute top-4 right-4 text-white text-2xl">&times;</button>
    </div>
</div>

<script>
// JavaScript for image preview modal (optional)
function openModal(src) {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    modal.classList.remove('hidden');
    modalImg.src = src;
}

function closeModal() {
    const modal = document.getElementById('imageModal');
    modal.classList.add('hidden');
}

// Add click listeners to all dog images
document.addEventListener('DOMContentLoaded', () => {
    const images = document.querySelectorAll('.grid img');
    images.forEach(img => {
        img.addEventListener('click', () => openModal(img.src));
    });
});
</script>
{% endblock %}