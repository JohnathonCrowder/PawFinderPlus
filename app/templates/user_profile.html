{% extends "base.html" %}

{% block title %}{{ user.full_name or user.username }}'s Profile - DogBreederPlus{% endblock %}

{% block head %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Inter', sans-serif;
    }
    .profile-bg {
        background-color: #f0f2f5;
    }
    .profile-header {
        background-image: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
    }
    .profile-picture {
        width: 180px;
        height: 180px;
        object-fit: cover;
        border-radius: 50%;
        border: 5px solid white;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }
    .card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
    }
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
    }
    .social-button {
        transition: all 0.3s ease;
    }
    .social-button:hover {
        transform: translateY(-2px);
    }
    .contact-icon {
        width: 48px;
        height: 48px;
        background-color: #f3f4f6;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #4a5568;
        font-size: 1.25rem;
    }
    .stat-card {
        border-radius: 12px;
        padding: 1rem;
        text-align: center;
        transition: all 0.3s ease;
    }
    .stat-card:hover {
        transform: scale(1.05);
    }
    .dog-card, .litter-card {
        transition: all 0.3s ease;
    }
    .dog-card:hover, .litter-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }
    .status-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: bold;
        text-transform: uppercase;
    }
    .status-available-now {
        background-color: #10B981;
        color: white;
    }
    .status-available-soon {
        background-color: #3B82F6;
        color: white;
    }
    .status-reserved {
        background-color: #F59E0B;
        color: white;
    }
    .status-sold {
        background-color: #EF4444;
        color: white;
    }
    .status-not-for-sale {
        background-color: #6B7280;
        color: white;
    }
    @keyframes pulse {
        0% {
            box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
        }
        70% {
            box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
        }
    }

    .copy-button {
        animation: pulse 2s infinite;
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-bg min-h-screen pb-12">
    <!-- Profile Header -->
    <div class="profile-header text-white py-20">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="flex flex-col md:flex-row items-center mb-6 md:mb-0">
                    {% if user.profile_picture_data %}
                        <img src="{{ url_for('user.get_profile_picture', user_id=user.id) }}" 
                             alt="{{ user.full_name or user.username }}" 
                             class="profile-picture mb-4 md:mb-0 md:mr-8">
                    {% else %}
                        <div class="profile-picture bg-gray-300 flex items-center justify-center mb-4 md:mb-0 md:mr-8">
                            <i class="fas fa-user text-5xl text-gray-500"></i>
                        </div>
                    {% endif %}
                    <div class="text-center md:text-left">
                        <h1 class="text-4xl font-bold mb-2">{{ user.full_name or user.username }}</h1>
                        
                        {% if user.city and user.country %}
    <p class="text-xl mb-2">
        <i class="fas fa-map-marker-alt mr-2"></i>
        {% if user.country == 'United States' %}
            {{ user.city }}, {{ user.state }}, USA
        {% else %}
            {{ user.city }}, {{ user.country }}
        {% endif %}
    </p>
{% endif %}
                        <p class="text-lg">Member since {{ user.created_at.strftime('%Y') }}</p>
                    </div>
                </div>


                <div class="flex space-x-4 mt-2">
                    <span class="text-gray-600">
                        <i class="fas fa-users mr-1"></i> Followers: <span id="followers-count">{{ followers_count }}</span>
                    </span>
                    <span class="text-gray-600">
                        <i class="fas fa-user-friends mr-1"></i> Following: <span id="following-count">{{ following_count }}</span>
                    </span>
                </div>

                <div class="flex space-x-4">
                    
                    {% if current_user.is_authenticated and current_user.id != user.id %}
                    <button id="followButton" onclick="toggleFollow({{ user.id }})" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                        <svg class="mr-2 -ml-1 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                            <path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"/>
                        </svg>
                        <span id="followButtonText">
                            {% if current_user.is_following(user) %}
                                Unfollow
                            {% else %}
                                Follow
                            {% endif %}
                        </span>
                    </button>
                {% endif %}

                    {% if user.website %}
                    <a href="{{ user.website }}" target="_blank" class="social-button bg-white text-purple-600 px-6 py-3 rounded-full font-semibold hover:bg-purple-100 transition duration-300">
                        <i class="fas fa-globe mr-2"></i>Website
                    </a>
                    {% endif %}
                    {% if user.facebook %}
                    <a href="{{ user.facebook }}" target="_blank" class="social-button bg-white text-blue-600 px-6 py-3 rounded-full font-semibold hover:bg-blue-100 transition duration-300">
                        <i class="fab fa-facebook mr-2"></i>Facebook
                    </a>
                    {% endif %}
                    {% if user.instagram %}
                    <a href="{{ user.instagram }}" target="_blank" class="social-button bg-white text-pink-600 px-6 py-3 rounded-full font-semibold hover:bg-pink-100 transition duration-300">
                        <i class="fab fa-instagram mr-2"></i>Instagram
                    </a>
                    {% endif %}
                    {% if current_user.is_authenticated and current_user.id != user.id %}
                    <a href="{{ url_for('message.conversation', user_id=user.id) }}" class="social-button bg-green-500 text-white px-6 py-3 rounded-full font-semibold hover:bg-green-600 transition duration-300">
                        <i class="fas fa-comments mr-2"></i>Chat
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 -mt-16">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Left Column -->
            <div class="md:col-span-1 space-y-8">
                <!-- About Card -->
                <div class="card p-8">
                    <h2 class="text-2xl font-semibold mb-4">About</h2>
                    {% if user.bio %}
                        <p class="text-gray-600 leading-relaxed">{{ user.bio }}</p>
                    {% else %}
                        <p class="text-gray-500 italic">No bio provided</p>
                    {% endif %}
                </div>

                <!-- Contact Card -->
                <div class="card p-8">
                    <h2 class="text-2xl font-semibold mb-6">Contact</h2>
                    {% if user.email or user.phone_number %}
                        <div class="space-y-6">
                            {% if user.email %}
                            <div class="flex items-center">
                                <div class="contact-icon mr-4 bg-blue-100 text-blue-500">
                                    <i class="fas fa-envelope"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">Email</p>
                                    <a href="mailto:{{ user.email }}" class="text-blue-600 hover:underline font-medium">{{ user.email }}</a>
                                </div>
                            </div>
                            {% endif %}
                            {% if user.phone_number %}
                            <div class="flex items-center">
                                <div class="contact-icon mr-4 bg-green-100 text-green-500">
                                    <i class="fas fa-phone"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500 mb-1">Phone</p>
                                    <a href="tel:{{ user.phone_number }}" class="text-green-600 hover:underline font-medium">{{ user.phone_number }}</a>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    {% else %}
                        <p class="text-gray-500 italic">No contact information provided</p>
                    {% endif %}
                    
                </div>

                <!-- Stats Card -->
                <div class="card p-8">
                    <h2 class="text-2xl font-semibold mb-6">Stats</h2>
                    <div class="grid grid-cols-2 gap-6">
                        <div class="stat-card bg-blue-50">
                            <p class="text-4xl font-bold text-blue-600 mb-1">{{ total_dogs }}</p>
                            <p class="text-gray-600 font-medium">Dogs</p>
                        </div>
                        <div class="stat-card bg-green-50">
                            <p class="text-4xl font-bold text-green-600 mb-1">{{ total_litters }}</p>
                            <p class="text-gray-600 font-medium">Litters</p>
                        </div>
                        <div class="stat-card bg-purple-50">
                            <p class="text-4xl font-bold text-purple-600 mb-1">{{ dog_breeds|length }}</p>
                            <p class="text-gray-600 font-medium">Breeds</p>
                        </div>
                        <div class="stat-card bg-yellow-50">
                            <p class="text-4xl font-bold text-yellow-600 mb-1">{{ user.created_at.strftime('%Y') }}</p>
                            <p class="text-gray-600 font-medium">Joined</p>
                        </div>
                    </div>
                </div>
            </div>
            

            <!-- Right Column -->
            <div class="md:col-span-2 space-y-8">

                <!-- Dogs Section -->
<div class="bg-gray-100 p-8 rounded-lg shadow-inner">
    <h2 class="text-3xl font-bold mb-6 text-gray-800">Dogs</h2>
    {% if dogs %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
        {% for dog in dogs %}
            {% if dog.is_public or (current_user.is_authenticated and current_user.id == user.id) %}
                <div class="dog-card bg-white rounded-xl shadow-lg overflow-hidden transform transition duration-300 hover:scale-105 hover:shadow-xl">
                    <div class="relative">
                        {% if dog.images %}
                            <img src="{{ url_for('dog.get_dog_image', image_id=dog.images[0].id) }}" 
                                 alt="{{ dog.name }}" 
                                 class="w-full h-64 object-cover">
                        {% else %}
                            <div class="w-full h-64 bg-gray-200 flex items-center justify-center">
                                <i class="fas fa-paw text-6xl text-gray-400"></i>
                            </div>
                        {% endif %}
                        <div class="absolute top-0 right-0 bg-white bg-opacity-75 m-2 px-2 py-1 rounded-full">
                            <span class="text-sm font-semibold text-gray-800">{{ dog.breed }}</span>
                        </div>
                    </div>
                    <div class="p-6">
                        <h3 class="font-bold text-xl mb-2 text-gray-800">{{ dog.name }}</h3>
                        <p class="text-sm text-gray-600 mb-2">Born: {{ dog.date_of_birth.strftime('%B %d, %Y') }}</p>
                        <div class="flex items-center justify-between mb-4">
                            <span class="status-badge status-{{ dog.status.value.lower().replace(' ', '-') }} text-xs font-bold px-3 py-1 rounded-full">
                                {{ dog.status.value }}
                            </span>
                            {% if dog.price and dog.status in [DogStatus.AVAILABLE_NOW, DogStatus.AVAILABLE_SOON] %}
                                <span class="text-green-600 font-bold text-lg">
                                    ${{ "%.2f"|format(dog.price) }}
                                </span>
                            {% endif %}
                        </div>
                        <a href="{{ url_for('dog.dog_profile', id=dog.id) }}" 
                           class="block w-full text-center bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full transition duration-300">
                            View Profile
                        </a>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
    {% else %}
        <div class="bg-white p-8 rounded-lg shadow text-center">
            <i class="fas fa-dog text-5xl text-gray-400 mb-4"></i>
            <p class="text-xl text-gray-600">No public dogs added yet</p>
        </div>
    {% endif %}
</div>
                <!-- Litters Section -->
<div class="card p-8">
    <h2 class="text-2xl font-semibold mb-6">Litters</h2>
    {% if litters %}
        <div class="grid grid-cols-1 gap-8">
            {% for litter in litters %}
                <div class="litter-card bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="flex flex-col md:flex-row">
                        <div class="w-full md:w-1/3 relative">
                            {% if litter.images %}
                                <div class="carousel relative w-full h-48 md:h-full" data-litter-id="{{ litter.id }}">
                                    {% for image in litter.images %}
                                        <img src="{{ url_for('litter.get_litter_image', image_id=image.id) }}" 
                                             alt="{{ litter.name }}" 
                                             class="w-full h-full object-cover absolute top-0 left-0 opacity-0 transition-opacity duration-500"
                                             style="{% if loop.first %}opacity: 1;{% endif %}">
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="w-full h-48 md:h-full bg-gray-200 flex items-center justify-center">
                                    <i class="fas fa-paw text-6xl text-gray-400"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div class="w-full md:w-2/3 p-6">
                            <h3 class="text-xl font-semibold mb-2">{{ litter.name }}</h3>
                            <p class="text-gray-600 mb-2"><i class="fas fa-calendar-alt mr-2"></i>Born: {{ litter.date_of_birth.strftime('%B %d, %Y') }}</p>
                            <p class="text-gray-600 mb-2"><i class="fas fa-dog mr-2"></i>Father: {{ litter.father.name }}</p>
                            <p class="text-gray-600 mb-2"><i class="fas fa-dog mr-2"></i>Mother: {{ litter.mother.name }}</p>
                            <p class="text-gray-600 mb-4"><i class="fas fa-paw mr-2"></i>Puppies: {{ litter.puppies|length }}</p>
                            <a href="{{ url_for('litter.litter_detail', id=litter.id) }}" class="inline-block bg-blue-500 text-white px-6 py-2 rounded-full text-sm font-medium hover:bg-blue-600 transition duration-300">View Litter</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-gray-500 italic">No litters added yet</p>
    {% endif %}
    <div class="mt-8 bg-gray-100 rounded-lg p-6 shadow-md">
        <h3 class="text-2xl font-semibold mb-4 text-gray-800">Share {{ user.username }}'s Profile</h3>
        
        <div class="flex flex-wrap gap-3 mb-6">
            <a href="{{ social_links.facebook }}" target="_blank" class="flex items-center justify-center w-12 h-12 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition duration-300" title="Share on Facebook">
                <i class="fab fa-facebook-f text-xl"></i>
            </a>
            <a href="{{ social_links.twitter }}" target="_blank" class="flex items-center justify-center w-12 h-12 bg-blue-400 text-white rounded-full hover:bg-blue-500 transition duration-300" title="Share on Twitter">
                <i class="fab fa-twitter text-xl"></i>
            </a>
            <a href="{{ social_links.linkedin }}" target="_blank" class="flex items-center justify-center w-12 h-12 bg-blue-700 text-white rounded-full hover:bg-blue-800 transition duration-300" title="Share on LinkedIn">
                <i class="fab fa-linkedin-in text-xl"></i>
            </a>
            <a href="{{ social_links.whatsapp }}" target="_blank" class="flex items-center justify-center w-12 h-12 bg-green-500 text-white rounded-full hover:bg-green-600 transition duration-300" title="Share on WhatsApp">
                <i class="fab fa-whatsapp text-xl"></i>
            </a>
            <a href="{{ social_links.email }}" class="flex items-center justify-center w-12 h-12 bg-gray-600 text-white rounded-full hover:bg-gray-700 transition duration-300" title="Share via Email">
                <i class="fas fa-envelope text-xl"></i>
            </a>
        </div>
    
        <div class="relative">
            <input type="text" value="{{ shareable_link }}" class="w-full p-3 pr-28 border rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-blue-500" readonly>
            <button onclick="copyToClipboard('{{ shareable_link }}')" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition duration-300 copy-button">
                Copy Link
            </button>
        </div>
    </div>
</div>


<script>
    function toggleFollow(userId) {
    const csrfToken = document.querySelector('meta[name="csrf-token"]');
    if (!csrfToken) {
        console.error('CSRF token not found');
        return;
    }
    

    const button = document.getElementById('followButton');
    const isFollowing = button.textContent.trim() === 'Unfollow';
    const url = isFollowing ? `/unfollow/${userId}` : `/follow/${userId}`;

    fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken.content,
            'X-Requested-With': 'XMLHttpRequest'
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const buttonText = document.getElementById('followButtonText');
            buttonText.textContent = isFollowing ? 'Follow' : 'Unfollow';
            
            // Update follower count
            const followersCount = document.getElementById('followers-count');
            if (followersCount) {
                followersCount.textContent = data.followers_count;
            }
            
            // Update following count for the current user if on their own profile
            if ({{ 'true' if is_own_profile else 'false' }}) {
                const followingCount = document.getElementById('following-count');
                if (followingCount) {
                    followingCount.textContent = data.following_count;
                }
            }
        } else {
            alert(data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while processing your request.');
    });
}
    </script>
<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiZGVmdGVybGFtYjYzIiwiYSI6ImNtMTg0b29kNTBzMnEyanB3YTl4bjl4eGQifQ.tjgnZiJbwQxeccVfe3oCKw';
    
    var geocoder = new MapboxGeocoder({
        accessToken: mapboxgl.accessToken,
        types: 'address',
        countries: 'us',
        placeholder: 'Search for an address',
    });
    
    geocoder.addTo('#geocoder');
    
    // Set initial value if available
    {% if user_data and user_data.address %}
        geocoder.setInput("{{ user_data.address }}");
    {% endif %}
    
    // Disable the input to prevent manual editing
    document.querySelector('.mapboxgl-ctrl-geocoder--input').setAttribute('readonly', true);
    </script>
            </div>
        </div>
    </div>
</div>
{% endblock %}