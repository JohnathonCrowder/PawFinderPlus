{% extends "base.html" %}

{% block title %}Puppy Litters Marketplace - DogBreederPlus{% endblock %}

{% block head %}
{{ super() }}
<style>
    .litter-card {
        transition: all 0.3s ease;
    }
    .litter-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    .filter-dropdown-menu {
        display: none;
    }
    .filter-dropdown-menu.show {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<div class="bg-gray-100 min-h-screen py-12">
    <div class="container mx-auto px-4">
        <h1 class="text-4xl font-bold mb-8 text-center text-gray-800">Puppy Litters Marketplace</h1>

        <!-- Filters Section -->
        <div class="mb-8 flex flex-wrap justify-between items-center">
            <div class="flex space-x-4 mb-4 md:mb-0">
                <div class="relative filter-dropdown">
                    <button class="filter-dropdown-toggle bg-white px-4 py-2 rounded-md shadow text-gray-700 hover:bg-gray-50">
                        Breed <i class="fas fa-chevron-down ml-2"></i>
                    </button>
                    <div class="filter-dropdown-menu absolute hidden bg-white mt-2 py-2 w-48 rounded-md shadow-xl z-10">
                        <a href="{{ url_for('public_litters', breed='All Breeds', age=current_age, search=search) }}" 
                           class="block px-4 py-2 text-gray-700 hover:bg-gray-100 {% if not current_breed %}font-bold{% endif %}">
                            All Breeds
                        </a>
                        {% for breed in breeds %}
                        <a href="{{ url_for('public_litters', breed=breed, age=current_age, search=search) }}" 
                           class="block px-4 py-2 text-gray-700 hover:bg-gray-100 {% if current_breed == breed %}font-bold{% endif %}">
                            {{ breed }}
                        </a>
                        {% endfor %}
                    </div>
                </div>
                <div class="relative filter-dropdown">
                    <button class="filter-dropdown-toggle bg-white px-4 py-2 rounded-md shadow text-gray-700 hover:bg-gray-50">
                        Age <i class="fas fa-chevron-down ml-2"></i>
                    </button>
                    <div class="filter-dropdown-menu absolute hidden bg-white mt-2 py-2 w-48 rounded-md shadow-xl z-10">
                        <a href="{{ url_for('public_litters', breed=current_breed, age='All Ages', search=search) }}" 
                           class="block px-4 py-2 text-gray-700 hover:bg-gray-100 {% if not current_age %}font-bold{% endif %}">
                            All Ages
                        </a>
                        <a href="{{ url_for('public_litters', breed=current_breed, age='0-4 weeks', search=search) }}" 
                           class="block px-4 py-2 text-gray-700 hover:bg-gray-100 {% if current_age == '0-4 weeks' %}font-bold{% endif %}">
                            0-4 weeks
                        </a>
                        <a href="{{ url_for('public_litters', breed=current_breed, age='4-8 weeks', search=search) }}" 
                           class="block px-4 py-2 text-gray-700 hover:bg-gray-100 {% if current_age == '4-8 weeks' %}font-bold{% endif %}">
                            4-8 weeks
                        </a>
                        <a href="{{ url_for('public_litters', breed=current_breed, age='8+ weeks', search=search) }}" 
                           class="block px-4 py-2 text-gray-700 hover:bg-gray-100 {% if current_age == '8+ weeks' %}font-bold{% endif %}">
                            8+ weeks
                        </a>
                    </div>
                </div>
            </div>
            <form action="{{ url_for('public_litters') }}" method="get" class="relative">
                <input type="hidden" name="breed" value="{{ current_breed }}">
                <input type="hidden" name="age" value="{{ current_age }}">
                <input type="text" name="search" placeholder="Search litters..." 
                       value="{{ search }}" class="w-full md:w-64 px-4 py-2 rounded-md shadow">
                <button type="submit" class="absolute right-0 top-0 mt-2 mr-2 text-gray-600 hover:text-gray-800">
                    <i class="fas fa-search"></i>
                </button>
            </form>
        </div>

        <!-- Litters Grid -->
        {% if litters %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for litter in litters %}
            <div class="litter-card bg-white rounded-lg shadow-md overflow-hidden">
                <div class="relative h-48">
                    {% if litter.images %}
                    <img src="{{ url_for('get_litter_image', image_id=litter.images[0].id) }}" 
                         alt="{{ litter.name }}" 
                         class="w-full h-full object-cover">
                    {% else %}
                    <div class="w-full h-full bg-gray-200 flex items-center justify-center">
                        <i class="fas fa-paw text-gray-400 text-4xl"></i>
                    </div>
                    {% endif %}
                    <div class="absolute top-0 right-0 bg-blue-500 text-white px-2 py-1 m-2 rounded-md text-sm">
                        {{ litter.puppies|length }} puppies
                    </div>
                </div>
                <div class="p-4">
                    <h2 class="text-xl font-semibold mb-2">{{ litter.name }}</h2>
                    <p class="text-gray-600 mb-2"><i class="fas fa-dog mr-2"></i>{{ litter.father.breed }}</p>
                    <p class="text-gray-600 mb-2"><i class="fas fa-calendar-alt mr-2"></i>Born: {{ litter.date_of_birth.strftime('%B %d, %Y') }}</p>
                    <p class="text-gray-600 mb-4"><i class="fas fa-map-marker-alt mr-2"></i>{{ litter.user.location or 'Location not specified' }}</p>
                    <a href="{{ url_for('litter_detail', id=litter.id) }}" 
                       class="block w-full text-center bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition duration-300">
                        View Litter
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-center text-gray-600 text-xl">No public litters available at the moment.</p>
        {% endif %}

        <!-- Pagination -->
        {% if pagination.pages > 1 %}
        <div class="mt-12 flex justify-center">
            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                {% if pagination.has_prev %}
                <a href="{{ url_for('public_litters', page=pagination.prev_num, breed=current_breed, age=current_age, search=search) }}" 
                   class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                    <span class="sr-only">Previous</span>
                    <i class="fas fa-chevron-left"></i>
                </a>
                {% endif %}
                
                {% for page_num in pagination.iter_pages(left_edge=1, left_current=2, right_current=2, right_edge=1) %}
                    {% if page_num %}
                        {% if pagination.page != page_num %}
                        <a href="{{ url_for('public_litters', page=page_num, breed=current_breed, age=current_age, search=search) }}" 
                           class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                            {{ page_num }}
                        </a>
                        {% else %}
                        <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-blue-50 text-sm font-medium text-blue-600">
                            {{ page_num }}
                        </span>
                        {% endif %}
                    {% else %}
                        <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
                            ...
                        </span>
                    {% endif %}
                {% endfor %}

                {% if pagination.has_next %}
                <a href="{{ url_for('public_litters', page=pagination.next_num, breed=current_breed, age=current_age, search=search) }}" 
                   class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                    <span class="sr-only">Next</span>
                    <i class="fas fa-chevron-right"></i>
                </a>
                {% endif %}
            </nav>
        </div>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const dropdowns = document.querySelectorAll('.filter-dropdown');

    dropdowns.forEach(dropdown => {
        const toggle = dropdown.querySelector('.filter-dropdown-toggle');
        const menu = dropdown.querySelector('.filter-dropdown-menu');

        toggle.addEventListener('click', (e) => {
            e.stopPropagation();
            menu.classList.toggle('show');
        });

        // Close the dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!dropdown.contains(e.target)) {
                menu.classList.remove('show');
            }
        });
    });
});
</script>
{% endblock %}